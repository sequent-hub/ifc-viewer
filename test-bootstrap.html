<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IFC Viewer – Bootstrap conflict test</title>

    <!-- Bootstrap (external app styles) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <style>
      body { padding: 16px; }
      #viewerMount { height: 520px; border: 1px solid #dee2e6; border-radius: 8px; overflow: hidden; }
      pre { white-space: pre-wrap; }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary rounded border mb-3">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Bootstrap page</a>
        <div class="d-flex gap-2">
          <button id="outsideBtn" class="btn btn-primary" type="button">Outside .btn (Bootstrap)</button>
          <button id="initViewerBtn" class="btn btn-outline-secondary" type="button">Init viewer</button>
        </div>
      </div>
    </nav>

    <div class="alert alert-info">
      Goal: importing and initializing viewer must not change Bootstrap styles outside <code>.ifc-viewer-container</code>.
      Open DevTools Console to see a style diff for the outside button.
    </div>

    <h5 class="mt-3">Viewer mount</h5>
    <div id="viewerMount"></div>

    <h5 class="mt-3">Outside button style diff</h5>
    <pre id="diffOut" class="border rounded p-3 bg-light">(click “Init viewer”)</pre>

    <script type="module">
      const pickStyles = (el) => {
        const cs = getComputedStyle(el);
        const keys = [
          "display",
          "paddingTop", "paddingRight", "paddingBottom", "paddingLeft",
          "borderTopLeftRadius", "borderTopRightRadius", "borderBottomRightRadius", "borderBottomLeftRadius",
          "fontFamily", "fontSize", "fontWeight", "lineHeight",
          "color", "backgroundColor", "borderTopWidth", "borderTopStyle", "borderTopColor",
        ];
        const out = {};
        for (const k of keys) out[k] = cs[k];
        return out;
      };

      const diff = (a, b) => {
        const keys = new Set([...Object.keys(a || {}), ...Object.keys(b || {})]);
        const out = {};
        for (const k of keys) {
          const av = a?.[k];
          const bv = b?.[k];
          if (av !== bv) out[k] = { before: av, after: bv };
        }
        return out;
      };

      const outsideBtn = document.getElementById("outsideBtn");
      const initViewerBtn = document.getElementById("initViewerBtn");
      const viewerMount = document.getElementById("viewerMount");
      const diffOut = document.getElementById("diffOut");

      const baseline = pickStyles(outsideBtn);
      console.log("[bootstrap-test] baseline(outsideBtn)", baseline);

      let viewer = null;

      initViewerBtn.addEventListener("click", async () => {
        if (viewer) return;

        // Import the default entry (auto-injects CSS)
        const { IfcViewer } = await import("./src/index.js");

        viewer = new IfcViewer({
          container: viewerMount,
          autoLoad: false,
          showToolbar: true,
          showControls: false,
          showSidebar: false,
        });
        await viewer.init();

        const after = pickStyles(outsideBtn);
        const d = diff(baseline, after);
        console.log("[bootstrap-test] after(outsideBtn)", after);
        console.log("[bootstrap-test] diff(outsideBtn)", d);
        diffOut.textContent = JSON.stringify(d, null, 2);
      });
    </script>
  </body>
</html>


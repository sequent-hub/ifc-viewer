<!DOCTYPE html>
<html lang="ru" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IFC Viewer Test - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞</title>
  
  <!-- DaisyUI –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@5.1.12/dist/full.min.css" rel="stylesheet" type="text/css" />
  
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      margin: 0;
      padding: 0;
      background: #f8f9fa;
    }
    .test-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .viewer-modal {
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }
    .viewer-content {
      width: 90vw;
      height: 80vh;
      max-width: 1100px;
      background: white;
      border-radius: 8px;
      overflow: hidden;
    }
    .demo-section {
      background: white;
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .code-block {
      background: #f1f5f9;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 16px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      overflow-x: auto;
      margin: 12px 0;
    }
  </style>
</head>
<body>
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
  <div class="navbar bg-base-100 shadow-lg">
    <div class="flex-1">
      <h1 class="text-xl font-bold">üèóÔ∏è IFC Viewer Test</h1>
    </div>
    <div class="flex-none">
      <button class="btn btn-ghost" onclick="toggleTheme()">üåì</button>
    </div>
  </div>

  <div class="test-container">
    <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
    <div class="demo-section">
      <h2 class="text-2xl font-bold mb-4">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞ @sequent-org/ifc-viewer</h2>
      <p class="text-gray-600 mb-4">
        –≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∞ <code>IfcViewer</code> –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –¥—Ä—É–≥–∏–µ –ø—Ä–æ–µ–∫—Ç—ã.
        –ü—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ, –∏–º–∏—Ç–∏—Ä—É—è —Ä–µ–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Laravel + Vite –ø—Ä–æ–µ–∫—Ç–µ.
      </p>
    </div>

    <!-- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è -->
    <div class="demo-section">
      <h3 class="text-lg font-semibold mb-3">üìã –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</h3>
      
      <h4 class="font-medium mb-2">1. –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:</h4>
      <div class="code-block">
import { IfcViewer } from '@sequent-org/ifc-viewer'

const viewer = new IfcViewer({
  container: document.getElementById('modal-content'),
  ifcUrl: '/path/to/model.ifc',
  showSidebar: true,
  showControls: true
})

await viewer.init()
      </div>

      <h4 class="font-medium mb-2">2. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</h4>
      <div class="code-block">
const viewer = new IfcViewer({
  container: '#viewer-container',
  autoLoad: false  // –Ω–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
})

await viewer.init()
await viewer.loadModel(userFile)  // File –æ–±—ä–µ–∫—Ç
      </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div class="demo-section">
      <h3 class="text-lg font-semibold mb-4">üß™ –¢–µ—Å—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</h3>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- –¢–µ—Å—Ç 1: –†–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é -->
        <div class="card bg-base-100 shadow">
          <div class="card-body">
            <h4 class="card-title text-base">–¢–µ—Å—Ç 1: –†–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</h4>
            <p class="text-sm text-gray-600 mb-4">
              –°–æ–∑–¥–∞—ë—Ç IfcViewer –≤ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ - —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫ —Å –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª—å—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
            </p>
            <div class="card-actions">
              <button class="btn btn-primary btn-sm" onclick="testDefault()">
                üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
              </button>
            </div>
          </div>
        </div>

        <!-- –¢–µ—Å—Ç 2: –†—É—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ -->  
        <div class="card bg-base-100 shadow">
          <div class="card-body">
            <h4 class="card-title text-base">–¢–µ—Å—Ç 2: –†—É—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞</h4>
            <p class="text-sm text-gray-600 mb-4">
              –°–æ–∑–¥–∞—ë—Ç IfcViewer –±–µ–∑ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏, –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª
            </p>
            <div class="card-actions">
              <button class="btn btn-secondary btn-sm" onclick="testManualLoad()">
                üìÅ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
              </button>
            </div>
          </div>
        </div>

        <!-- –¢–µ—Å—Ç 3: –ë–µ–∑ –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏ -->
        <div class="card bg-base-100 shadow">
          <div class="card-body">
            <h4 class="card-title text-base">–¢–µ—Å—Ç 3: –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫</h4>
            <p class="text-sm text-gray-600 mb-4">
              –°–æ–∑–¥–∞—ë—Ç IfcViewer –≤–æ–æ–±—â–µ –±–µ–∑ –ø–∞–Ω–µ–ª–µ–π - —á–∏—Å—Ç—ã–π 3D –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫
            </p>
            <div class="card-actions">
              <button class="btn btn-accent btn-sm" onclick="testCleanViewer()">
                ‚ö° –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
              </button>
            </div>
          </div>
        </div>

        <!-- –¢–µ—Å—Ç 4: –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ -->
        <div class="card bg-base-100 shadow">
          <div class="card-body">
            <h4 class="card-title text-base">–¢–µ—Å—Ç 4: –¢—ë–º–Ω–∞—è —Ç–µ–º–∞</h4>
            <p class="text-sm text-gray-600 mb-4">
              –°–æ–∑–¥–∞—ë—Ç IfcViewer —Å —Ç—ë–º–Ω–æ–π —Ç–µ–º–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            </p>
            <div class="card-actions">
              <button class="btn btn-neutral btn-sm" onclick="testDarkTheme()">
                üåô –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
              </button>
            </div>
          </div>
        </div>

        <!-- –¢–µ—Å—Ç 5: –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –ø–∞–Ω–µ–ª–µ–π -->
        <div class="card bg-base-100 shadow">
          <div class="card-body">
            <h4 class="card-title text-base">–¢–µ—Å—Ç 5: –í—Å–µ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h4>
            <p class="text-sm text-gray-600 mb-4">
              –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏: –≤–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å, –±–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
            </p>
            <div class="card-actions">
              <button class="btn btn-info btn-sm" onclick="testFullToolbar()">
                üéõÔ∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
              </button>
            </div>
          </div>
        </div>

        <!-- –¢–µ—Å—Ç 6: –ë–µ–∑ –ø–∞–Ω–µ–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ -->
        <div class="card bg-base-100 shadow">
          <div class="card-body">
            <h4 class="card-title text-base">–¢–µ—Å—Ç 6: –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫</h4>
            <p class="text-sm text-gray-600 mb-4">
              –°–æ–∑–¥–∞—ë—Ç IfcViewer –±–µ–∑ –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏, —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
            </p>
            <div class="card-actions">
              <button class="btn btn-warning btn-sm" onclick="testNoToolbar()">
                üîç –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π -->
    <div class="demo-section">
      <h3 class="text-lg font-semibold mb-3">üìù –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π</h3>
      <div id="eventLog" class="bg-gray-50 border rounded p-4 h-32 overflow-y-auto font-mono text-sm">
        <div class="text-gray-500">–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ª—é–±–æ–π —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ–±—ã—Ç–∏–π...</div>
      </div>
      <button class="btn btn-outline btn-sm mt-2" onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫–∞ -->
  <div id="viewerModal" class="fixed inset-0 viewer-modal hidden items-center justify-center z-50">
    <div class="viewer-content relative">
      <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ -->
      <div class="absolute top-4 left-4 z-10 bg-white/90 backdrop-blur rounded px-3 py-2 shadow">
        <span id="modalTitle" class="font-medium">IFC Viewer</span>
      </div>
      
      <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è -->
      <button 
        class="absolute top-4 right-4 z-10 btn btn-circle btn-sm bg-white/90 backdrop-blur shadow"
        onclick="closeViewer()"
      >
        ‚úï
      </button>

      <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è IfcViewer -->
      <div id="viewerContainer" class="w-full h-full"></div>
    </div>
  </div>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å -->
  <script type="module">
    import { IfcViewer } from './src/index.js'

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–æ–≤
    window.currentViewer = null
    window.IfcViewer = IfcViewer

    // –§—É–Ω–∫—Ü–∏–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    function logEvent(message, type = 'info') {
      const log = document.getElementById('eventLog')
      const time = new Date().toLocaleTimeString()
      const color = {
        info: 'text-blue-600',
        success: 'text-green-600', 
        error: 'text-red-600',
        warning: 'text-orange-600'
      }[type] || 'text-gray-600'
      
      log.innerHTML += `<div class="${color}">[${time}] ${message}</div>`
      log.scrollTop = log.scrollHeight
    }

    function clearLog() {
      document.getElementById('eventLog').innerHTML = 
        '<div class="text-gray-500">–õ–æ–≥ –æ—á–∏—â–µ–Ω...</div>'
    }

    // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
    function showModal(title = 'IFC Viewer') {
      document.getElementById('modalTitle').textContent = title
      const modal = document.getElementById('viewerModal')
      modal.classList.remove('hidden')
      modal.classList.add('flex')
    }

    function closeViewer() {
      if (window.currentViewer) {
        logEvent('–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫–∞...', 'info')
        window.currentViewer.dispose()
        window.currentViewer = null
      }
      
      const modal = document.getElementById('viewerModal')
      modal.classList.add('hidden')
      modal.classList.remove('flex')
      
      // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
      document.getElementById('viewerContainer').innerHTML = ''
      logEvent('–ü—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫ –∑–∞–∫—Ä—ã—Ç', 'success')
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    function toggleTheme() {
      const html = document.documentElement
      const current = html.getAttribute('data-theme')
      html.setAttribute('data-theme', current === 'dark' ? 'light' : 'dark')
      logEvent(`–¢–µ–º–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞: ${current === 'dark' ? 'light' : 'dark'}`, 'info')
    }

    // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Å–æ–±—ã—Ç–∏–π
    async function createViewer(options, title) {
      try {
        logEvent(`–°–æ–∑–¥–∞–Ω–∏–µ IfcViewer: ${title}`, 'info')
        showModal(title)
        
        const container = document.getElementById('viewerContainer')
        const viewer = new IfcViewer({
          container,
          ...options
        })

        // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫–∞
        container.addEventListener('ifcviewer:ready', (e) => {
          logEvent('–ü—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ', 'success')
        })

        container.addEventListener('ifcviewer:model-loaded', (e) => {
          const modelInfo = e.detail.model
          logEvent(`–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞: modelID=${modelInfo?.modelID}`, 'success')
        })

        container.addEventListener('ifcviewer:error', (e) => {
          logEvent(`–û—à–∏–±–∫–∞: ${e.detail.error.message}`, 'error')
        })

        await viewer.init()
        window.currentViewer = viewer
        
        return viewer
      } catch (error) {
        logEvent(`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫–∞: ${error.message}`, 'error')
        closeViewer()
        throw error
      }
    }

    // –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏  
    window.testDefault = async function() {
      await createViewer({
        ifcUrl: '/ifc/170–û–ö-23_1_1_–ê–†_–ü.ifc'
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: 
        // showSidebar: false, showControls: false, showToolbar: true
      }, '–¢–µ—Å—Ç 1: –†–µ–∂–∏–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é')
    }

    window.testManualLoad = async function() {
      await createViewer({
        autoLoad: false,
        showSidebar: true,
        showControls: true
      }, '–¢–µ—Å—Ç 2: –†—É—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞')
    }

    window.testCleanViewer = async function() {
      await createViewer({
        ifcUrl: '/ifc/170–û–ö-23_1_1_–ê–†_–ü.ifc',
        showSidebar: false,
        showControls: false,
        showToolbar: false,
        autoLoad: true
      }, '–¢–µ—Å—Ç 3: –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫')
    }

    window.testDarkTheme = async function() {
      await createViewer({
        ifcUrl: '/ifc/170–û–ö-23_1_1_–ê–†_–ü.ifc',
        showSidebar: true,
        showControls: true,
        autoLoad: true,
        theme: 'dark'
      }, '–¢–µ—Å—Ç 4: –¢—ë–º–Ω–∞—è —Ç–µ–º–∞')
    }

    window.testFullToolbar = async function() {
      await createViewer({
        ifcUrl: '/ifc/170–û–ö-23_1_1_–ê–†_–ü.ifc',
        showSidebar: true,
        showControls: true,
        showToolbar: true,
        autoLoad: true,
        theme: 'light'
      }, '–¢–µ—Å—Ç 5: –í—Å–µ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è')
    }

    window.testNoToolbar = async function() {
      await createViewer({
        ifcUrl: '/ifc/170–û–ö-23_1_1_–ê–†_–ü.ifc',
        showSidebar: true,
        showControls: true,
        showToolbar: false,
        autoLoad: true,
        theme: 'light'
      }, '–¢–µ—Å—Ç 6: –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫')
    }

    // –£—Ç–∏–ª–∏—Ç—ã
    window.logEvent = logEvent
    window.clearLog = clearLog
    window.toggleTheme = toggleTheme
    window.closeViewer = closeViewer

    // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    logEvent('–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞.', 'success')
  </script>
</body>
</html>
